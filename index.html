<script>
    const webhookUrl = 'https://nextency.app.n8n.cloud/webhook/7c2e2895-569e-4622-81a1-b82f7fea4169';
    const videoLinkForm = document.getElementById('video-link-form' );
    const appContainer = document.getElementById('app');

    // Obsługa formularza KROK 2
    videoLinkForm.addEventListener('submit', async (e) => {
        // 1. Zapobiegaj domyślnej, pustej wysyłce formularza
        e.preventDefault();
        
        // 2. Pokaż użytkownikowi komunikat o rozpoczęciu procesu
        appContainer.innerHTML = `
            <h1>Rozpoczynamy generowanie wideo...</h1>
            <p>Wideo zostanie wysłane na Twój e-mail, gdy będzie gotowe. To może potrwać kilka minut.</p>
        `;

        // 3. Zbierz wszystkie dane z formularza (w tym plik)
        const formData = new FormData(e.target);
        
        try {
            // 4. Wyślij dane do webhooka n8n za pomocą fetch
            const response = await fetch(webhookUrl, {
                method: 'POST',
                body: formData, // FormData automatycznie obsługuje wysyłkę plików
            });
            
            // 5. Obsłuż ewentualne błędy serwera
            if (!response.ok) {
                throw new Error(`Błąd serwera n8n: ${response.status}`);
            }
            
        } catch (error) {
            // 6. Pokaż komunikat o błędzie, jeśli wysyłka się nie uda
            appContainer.innerHTML = `
                <h1>Wystąpił krytyczny błąd</h1>
                <p>Nie udało się połączyć z serwerem w celu rozpoczęcia generowania: ${error.message}</p>
                <p>Sprawdź swoje połączenie internetowe i spróbuj ponownie.</p>
                <button onclick="window.location.reload()">Spróbuj ponownie</button>
            `;
        }
    });
</script>
